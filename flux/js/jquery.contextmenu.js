/*
 * jQuery contextMenu - Plugin for simple contextMenu handling
 *
 * Version: 1.5.3
 *
 * Authors: Rodney Rehm, Addy Osmani (patches for FF)
 * Web: http://medialize.github.com/jQuery-contextMenu/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
(function(e,l){function A(a){for(var a=a.split(/\s+/),b=[],d=0,c;c=a[d];d++)c=c[0].toUpperCase(),b.push(c);return b}function p(a){return a.id&&e('label[for="'+a.id+'"]').val()||a.name}function y(a,b,d){d||(d=0);b.each(function(){var b=e(this),h=this,g=this.nodeName.toLowerCase(),f,j;"label"==g&&b.find("input, textarea, select").length&&(f=b.text(),b=b.children().first(),h=b.get(0),g=h.nodeName.toLowerCase());switch(g){case "menu":j={name:b.attr("label"),items:{}};y(j.items,b.children(),d);break;case "a":case "button":j=
{name:b.text(),disabled:!!b.attr("disabled"),callback:function(){return function(){b.click()}}()};break;case "menuitem":case "command":switch(b.attr("type")){case l:case "command":case "menuitem":j={name:b.attr("label"),disabled:!!b.attr("disabled"),callback:function(){return function(){b.click()}}()};break;case "checkbox":j={type:"checkbox",disabled:!!b.attr("disabled"),name:b.attr("label"),selected:!!b.attr("checked")};break;case "radio":j={type:"radio",disabled:!!b.attr("disabled"),name:b.attr("label"),
radio:b.attr("radiogroup"),value:b.attr("id"),selected:!!b.attr("checked")};break;default:j=l}break;case "hr":j="-------";break;case "input":switch(b.attr("type")){case "text":j={type:"text",name:f||p(h),disabled:!!b.attr("disabled"),value:b.val()};break;case "checkbox":j={type:"checkbox",name:f||p(h),disabled:!!b.attr("disabled"),selected:!!b.attr("checked")};break;case "radio":j={type:"radio",name:f||p(h),disabled:!!b.attr("disabled"),radio:!!b.attr("name"),value:b.val(),selected:!!b.attr("checked")};
break;default:j=l}break;case "select":j={type:"select",name:f||p(h),disabled:!!b.attr("disabled"),selected:b.val(),options:{}};b.children().each(function(){j.options[this.value]=e(this).text()});break;case "textarea":j={type:"textarea",name:f||p(h),disabled:!!b.attr("disabled"),value:b.val()};break;case "label":break;default:j={type:"html",html:b.clone(!0)}}j&&(d++,a["key"+d]=j)})}e.support.htmlMenuitem="HTMLMenuItemElement"in window;e.support.htmlCommand="HTMLCommandElement"in window;var i=null,
r=!1,s=!1,n=e(window),t=0,k={},o={},u={},v={selector:null,appendTo:null,trigger:"right",autoHide:!1,ignoreRightClick:!1,delay:200,determinePosition:function(a){if(e.ui&&e.ui.position)a.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var b=this.offset();b.top+=this.outerHeight();b.left+=this.outerWidth()/2-a.outerWidth()/2;a.css(b)}},position:function(a,b,d){if(!b&&!d)a.determinePosition.call(this,a.$menu);else{"maintain"===
b&&"maintain"===d?b=a.$menu.position():(a.$trigger.parents().andSelf().filter(function(){return"fixed"==e(this).css("position")}).length&&(d-=n.scrollTop(),b-=n.scrollLeft()),b={top:d,left:b});var d=n.scrollTop()+n.height(),c=n.scrollLeft()+n.width(),h=a.$menu.height(),f=a.$menu.width();b.top+h>d&&(b.top-=h);b.left+f>c&&(b.left-=f);a.$menu.css(b)}},positionSubmenu:function(a){if(e.ui&&e.ui.position)a.css("display","block").position({my:"left top",at:"right top",of:this,collision:"fit"}).css("display",
"");else{var b=this.offset();b.top+=0;b.left+=this.outerWidth();a.css(b)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},q=null,w=null,x=null,z,B=function(a){for(var b=0;!(b=Math.max(b,parseInt(a.css("z-index"),10)||0),a=a.parent(),!a||!a.length||"body"==a.prop("nodeName").toLowerCase()););return b},f={abortevent:function(a){a.preventDefault();a.stopImmediatePropagation()},contextmenu:function(a){var b=e(this);a.preventDefault();
a.stopImmediatePropagation();s?s=!1:b.hasClass("context-menu-disabled")||(i=b,a.data.build&&(e.extend(!0,a.data,v,a.data.build(i)||{}),m.create(a.data)),m.show.call(b,a.data,a.pageX,a.pageY))},click:function(a){a.preventDefault();a.stopImmediatePropagation();e(this).trigger(jQuery.Event("contextmenu",{data:a.data,pageX:a.pageX,pageY:a.pageY}))},mousedown:function(a){var b=e(this);i&&i.length&&!i.is(b)&&i.data("contextMenu").$menu.trigger("contextmenu:hide");2==a.button&&(i=b.data("contextMenuActive",
!0))},mouseup:function(a){var b=e(this);b.data("contextMenuActive")&&i&&i.length&&i.is(b)&&!b.hasClass("context-menu-disabled")&&(a.preventDefault(),a.stopImmediatePropagation(),i=b,b.trigger(jQuery.Event("contextmenu",{data:a.data,pageX:a.pageX,pageY:a.pageY})));b.removeData("contextMenuActive")},mouseenter:function(a){var b=e(this),d=e(a.relatedTarget),c=e(document);if(!d.is(".context-menu-list")&&!d.closest(".context-menu-list").length&&(!i||!i.length))w=a.pageX,x=a.pageY,z=a.data,c.on("mousemove.contextMenuShow",
f.mousemove),q=setTimeout(function(){q=null;c.off("mousemove.contextMenuShow");i=b;b.trigger(jQuery.Event("contextmenu",{data:z,pageX:w,pageY:x}))},a.data.delay)},mousemove:function(a){w=a.pageX;x=a.pageY},mouseleave:function(a){a=e(a.relatedTarget);if(!a.is(".context-menu-list")&&!a.closest(".context-menu-list").length){try{clearTimeout(q)}catch(b){}q=null}},ignoreRightClick:function(a){2==a.button&&(s=!0)},layerClick:function(a){var b=e(this),d=b.data("contextMenuRoot");a.preventDefault();a.stopImmediatePropagation();
b.remove();d.$menu.trigger("contextmenu:hide")},keyStop:function(a,b){b.isInput||a.preventDefault();a.stopPropagation()},key:function(a){var b=i.data("contextMenu")||{};b.$menu.children();switch(a.keyCode){case 9:case 38:if(f.keyStop(a,b),b.isInput){if(9==a.keyCode&&a.shiftKey){a.preventDefault();b.$selected&&b.$selected.find("input, textarea, select").blur();b.$menu.trigger("prevcommand");return}if(38==a.keyCode&&"checkbox"==b.$selected.find("input, textarea, select").prop("type")){a.preventDefault();
return}}else if(9!=a.keyCode||a.shiftKey){b.$menu.trigger("prevcommand");return}case 9:case 40:f.keyStop(a,b);if(b.isInput){if(9==a.keyCode){a.preventDefault();b.$selected&&b.$selected.find("input, textarea, select").blur();b.$menu.trigger("nextcommand");return}if(40==a.keyCode&&"checkbox"==b.$selected.find("input, textarea, select").prop("type")){a.preventDefault();return}}else{b.$menu.trigger("nextcommand");return}break;case 37:f.keyStop(a,b);if(b.isInput||!b.$selected||!b.$selected.length)break;
if(!b.$selected.parent().hasClass("context-menu-root")){a=b.$selected.parent().parent();b.$selected.trigger("contextmenu:blur");b.$selected=a;return}break;case 39:f.keyStop(a,b);if(b.isInput||!b.$selected||!b.$selected.length)break;var d=b.$selected.data("contextMenu")||{};if(d.$menu&&b.$selected.hasClass("context-menu-submenu")){b.$selected=null;d.$selected=null;d.$menu.trigger("nextcommand");return}break;case 13:f.keyStop(a,b);if(b.isInput){if(b.$selected&&!b.$selected.is(":textarea, :select")){a.preventDefault();
return}break}b.$selected&&b.$selected.trigger("mouseup");return;case 32:f.keyStop(a,b);return;case 27:f.keyStop(a,b);b.$menu.trigger("contextmenu:hide");return;default:if(d=String.fromCharCode(a.keyCode).toUpperCase(),b.accesskeys[d]){b.accesskeys[d].$node.trigger(b.accesskeys[d].$menu?"contextmenu:focus":"mouseup");return}}a.stopPropagation();b.$selected&&b.$selected.trigger(a)},prevItem:function(a){a.stopPropagation();var b=e(this).data("contextMenu")||{};if(b.$selected){var d=b.$selected,b=b.$selected.parent().data("contextMenu")||
{};b.$selected=d}for(var d=b.$menu.children(),c=!b.$selected||!b.$selected.prev().length?d.last():b.$selected.prev(),h=c;c.hasClass("disabled")||c.hasClass("not-selectable");)if(c=c.prev().length?c.prev():d.last(),c.is(h))return;b.$selected&&f.itemMouseleave.call(b.$selected.get(0),a);f.itemMouseenter.call(c.get(0),a);a=c.find("input, textarea, select");a.length&&a.focus()},nextItem:function(a){a.stopPropagation();var b=e(this).data("contextMenu")||{};if(b.$selected){var d=b.$selected,b=b.$selected.parent().data("contextMenu")||
{};b.$selected=d}for(var d=b.$menu.children(),c=!b.$selected||!b.$selected.next().length?d.first():b.$selected.next(),h=c;c.hasClass("disabled")||c.hasClass("not-selectable");)if(c=c.next().length?c.next():d.first(),c.is(h))return;b.$selected&&f.itemMouseleave.call(b.$selected.get(0),a);f.itemMouseenter.call(c.get(0),a);a=c.find("input, textarea, select");a.length&&a.focus()},focusInput:function(){var a=e(this).closest(".context-menu-item"),b=a.data(),d=b.contextMenu,b=b.contextMenuRoot;b.$selected=
d.$selected=a;b.isInput=d.isInput=!0},blurInput:function(){var a=e(this).closest(".context-menu-item").data();a.contextMenuRoot.isInput=a.contextMenu.isInput=!1},menuMouseenter:function(){e(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(a){var b=e(this).data().contextMenuRoot;if(b.$layer&&b.$layer.is(a.relatedTarget))b.hovering=!1},itemMouseenter:function(a){var b=e(this),d=b.data(),c=d.contextMenu,d=d.contextMenuRoot;d.hovering=!0;a&&d.$layer&&d.$layer.is(a.relatedTarget)&&(a.preventDefault(),
a.stopImmediatePropagation());(c.$menu?c:d).$menu.children(".hover").trigger("contextmenu:blur");b.hasClass("disabled")||b.hasClass("not-selectable")?c.$selected=null:b.trigger("contextmenu:focus")},itemMouseleave:function(a){var b=e(this),d=b.data(),c=d.contextMenu,d=d.contextMenuRoot;d!==c&&d.$layer&&d.$layer.is(a.relatedTarget)?(d.$selected&&d.$selected.trigger("contextmenu:blur"),a.preventDefault(),a.stopImmediatePropagation(),d.$selected=c.$selected=c.$node):b.trigger("contextmenu:blur")},itemClick:function(a){var b=
e(this),d=b.data(),c=d.contextMenuRoot,f=d.contextMenuKey;if(d.contextMenu.items[f]&&!b.hasClass("disabled")){a.preventDefault();a.stopImmediatePropagation();if(e.isFunction(c.callbacks[f]))a=c.callbacks[f];else if(e.isFunction(c.callback))a=c.callback;else return;!1!==a.call(c.$trigger,f,c)?c.$menu.trigger("contextmenu:hide"):m.update.call(c.$trigger,c)}},inputClick:function(a){a.stopImmediatePropagation()},hideMenu:function(){var a=e(this).data("contextMenuRoot");m.hide.call(a.$trigger,a)},focusItem:function(a){a.stopPropagation();
var a=e(this),b=a.data(),d=b.contextMenu,b=b.contextMenuRoot;a.addClass("hover").siblings(".hover").trigger("contextmenu:blur");d.$selected=b.$selected=a;d.$node&&b.positionSubmenu.call(d.$node,d.$menu)},blurItem:function(a){a.stopPropagation();var a=e(this),b=a.data().contextMenu;a.removeClass("hover");b.$selected=null}},m={show:function(a,b,d){var c=e(this),h={};e("#context-menu-layer").trigger("mousedown");if(!1===a.events.show.call(c,a))i=null;else{a.$trigger=c;m.update.call(c,a);a.position.call(c,
a,b,d);if(a.zIndex)h.zIndex=B(c)+a.zIndex;m.layer.call(a.$menu,a,h.zIndex);a.$menu.css(h)[a.animation.show](a.animation.duration);c.data("contextMenu",a);e(document).off("keydown.contextMenu").on("keydown.contextMenu",f.key);if(a.autoHide){var g=c.position();g.right=g.left+c.outerWidth();g.bottom=g.top+this.outerHeight();e(document).on("mousemove.contextMenuAutoHide",function(b){a.$layer&&!a.hovering&&(!(b.pageX>=g.left&&b.pageX<=g.right)||!(b.pageY>=g.top&&b.pageY<=g.bottom))&&a.$layer.trigger("mousedown")})}}},
hide:function(a){var b=e(this);a||(a=b.data("contextMenu")||{});if(!(a.events&&!1===a.events.hide.call(b,a))){if(a.$layer)try{a.$layer.remove(),delete a.$layer}catch(d){a.$layer=null}i=null;a.$menu.find(".hover").trigger("contextmenu:blur");a.$selected=null;e(document).off(".contextMenuAutoHide").off("keydown.contextMenu");a.$menu&&a.$menu[a.animation.hide](a.animation.duration);a.build&&(a.$menu.remove(),e.each(a,function(b){switch(b){case "ns":case "selector":case "build":case "trigger":case "ignoreRightClick":return!0;
default:a[b]=l;try{delete a[b]}catch(d){}return!0}}))}},create:function(a,b){b===l&&(b=a);a.$menu=e('<ul class="context-menu-list '+(a.className||"")+'"></ul>').data({contextMenu:a,contextMenuRoot:b});e.each(["callbacks","commands","inputs"],function(d,c){a[c]={};b[c]||(b[c]={})});b.accesskeys||(b.accesskeys={});e.each(a.items,function(d,c){var h=e('<li class="context-menu-item '+(c.className||"")+'"></li>'),g=null,i=null;c.$node=h.data({contextMenu:a,contextMenuRoot:b,contextMenuKey:d});if(c.accesskey)for(var j=
A(c.accesskey),l=0,k;k=j[l];l++)if(!b.accesskeys[k]){b.accesskeys[k]=c;c._name=c.name.replace(RegExp("("+k+")","i"),'<span class="context-menu-accesskey">$1</span>');break}if("string"==typeof c)h.addClass("context-menu-separator not-selectable");else if(c.type&&u[c.type])u[c.type].call(h,c,a,b),e.each([a,b],function(b,a){a.commands[d]=c;if(e.isFunction(c.callback))a.callbacks[d]=c.callback});else{if("html"==c.type)h.addClass("context-menu-html not-selectable");else if(c.type)g=e("<label></label>").appendTo(h),
e("<span></span>").html(c._name||c.name).appendTo(g),h.addClass("context-menu-input"),a.hasTypes=!0,e.each([a,b],function(b,a){a.commands[d]=c;a.inputs[d]=c});else if(c.items)c.type="sub";switch(c.type){case "text":i=e('<input type="text" value="1" name="context-menu-input-'+d+'" value="">').val(c.value||"").appendTo(g);break;case "textarea":i=e('<textarea name="context-menu-input-'+d+'"></textarea>').val(c.value||"").appendTo(g);c.height&&i.height(c.height);break;case "checkbox":i=e('<input type="checkbox" value="1" name="context-menu-input-'+
d+'" value="">').val(c.value||"").prop("checked",!!c.selected).prependTo(g);break;case "radio":i=e('<input type="radio" value="1" name="context-menu-input-'+c.radio+'" value="">').val(c.value||"").prop("checked",!!c.selected).prependTo(g);break;case "select":i=e('<select name="context-menu-input-'+d+'">').appendTo(g);c.options&&(e.each(c.options,function(b,a){e("<option></option>").val(b).text(a).appendTo(i)}),i.val(c.selected));break;case "sub":e("<span></span>").html(c._name||c.name).appendTo(h);
c.appendTo=c.$node;m.create(c,b);h.data("contextMenu",c).addClass("context-menu-submenu");c.callback=null;break;case "html":e(c.html).appendTo(h);break;default:e.each([a,b],function(b,a){a.commands[d]=c;if(e.isFunction(c.callback))a.callbacks[d]=c.callback}),e("<span></span>").html(c._name||c.name||"").appendTo(h)}if(c.type&&"sub"!=c.type&&"html"!=c.type&&(i.on("focus",f.focusInput).on("blur",f.blurInput),c.events))i.on(c.events);c.icon&&h.addClass("icon icon-"+c.icon)}c.$input=i;c.$label=g;h.appendTo(a.$menu);
if(!a.hasTypes)if(e.browser.msie)h.on("selectstart.disableTextSelect",f.abortevent);else if(!e.browser.mozilla)h.on("mousedown.disableTextSelect",f.abortevent)});a.$node||a.$menu.css("display","none").addClass("context-menu-root");a.$menu.appendTo(a.appendTo||document.body)},update:function(a,b){var d=this;b===l&&(b=a,a.$menu.find("ul").andSelf().css({position:"static",display:"block"}).each(function(){var b=e(this);b.width(b.css("position","absolute").width()).css("position","static")}).css({position:"",
display:""}));a.$menu.children().each(function(){var c=e(this),f=c.data("contextMenuKey"),g=a.items[f],f=e.isFunction(g.disabled)&&g.disabled.call(d,f,b)||!0===g.disabled;c[f?"addClass":"removeClass"]("disabled");if(g.type)switch(c.find("input, select, textarea").prop("disabled",f),g.type){case "text":case "textarea":g.$input.val(g.value||"");break;case "checkbox":case "radio":g.$input.val(g.value||"").prop("checked",!!g.selected);break;case "select":g.$input.val(g.selected||"")}g.$menu&&m.update.call(d,
g,b)})},layer:function(a,b){return a.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+b+'; top:0; left:0; opacity: 0;"></div>').css({height:n.height(),width:n.width(),display:"block"}).data("contextMenuRoot",a).insertBefore(this).on("mousedown",f.layerClick)}};e.fn.contextMenu=function(a){a===l?this.first().trigger("contextmenu"):a.x&&a.y?this.first().trigger(jQuery.Event("contextmenu",{pageX:a.x,pageY:a.y})):"hide"===a?(a=this.data("contextMenu").$menu)&&a.trigger("contextmenu:hide"):
a?this.removeClass("context-menu-disabled"):a||this.addClass("context-menu-disabled");return this};e.contextMenu=function(a,b){"string"!=typeof a&&(b=a,a="create");"string"==typeof b?b={selector:b}:b===l&&(b={});var d=e.extend(!0,{},v,b||{}),c=c=e(document);switch(a){case "create":if(!d.selector)throw Error("No selector specified");if(d.selector.match(/.context-menu-(list|item|input)($|\s)/))throw Error('Cannot bind to selector "'+d.selector+'" as it contains a reserved className');if(!d.build&&(!d.items||
e.isEmptyObject(d.items)))throw Error("No Items sepcified");t++;d.ns=".contextMenu"+t;k[d.selector]=d.ns;o[d.ns]=d;r||(c.on({"contextmenu:hide.contextMenu":f.hideMenu,"prevcommand.contextMenu":f.prevItem,"nextcommand.contextMenu":f.nextItem,"contextmenu.contextMenu":f.abortevent,"mouseenter.contextMenu":f.menuMouseenter,"mouseleave.contextMenu":f.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",f.inputClick).on({"mouseup.contextMenu":f.itemClick,"contextmenu:focus.contextMenu":f.focusItem,
"contextmenu:blur.contextMenu":f.blurItem,"contextmenu.contextMenu":f.abortevent,"mouseenter.contextMenu":f.itemMouseenter,"mouseleave.contextMenu":f.itemMouseleave},".context-menu-item"),r=!0);c.on("contextmenu"+d.ns,d.selector,d,f.contextmenu);switch(d.trigger){case "hover":c.on("mouseenter"+d.ns,d.selector,d,f.mouseenter).on("mouseleave"+d.ns,d.selector,d,f.mouseleave);break;case "left":c.on("click"+d.ns,d.selector,d,f.click)}if("hover"!=d.trigger&&d.ignoreRightClick)c.on("mousedown"+d.ns,d.selector,
f.ignoreRightClick);d.build||m.create(d);break;case "destroy":if(d.selector){if(k[d.selector]){try{o[k[d.selector]].$menu&&o[k[d.selector]].$menu.remove(),delete o[k[d.selector]]}catch(h){o[k[d.selector]]=null}c.off(k[d.selector])}}else c.off(".contextMenu .contextMenuAutoHide"),e.each(k,function(b,a){c.off(a)}),k={},o={},t=0,r=!1,e(".context-menu-list").remove();break;case "html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof b&&b)&&e('menu[type="context"]').each(function(){this.id&&
e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw Error('Unknown operation "'+a+'"');}return this};e.contextMenu.setInputValues=function(a,b){b===l&&(b={});e.each(a.inputs,function(a,c){switch(c.type){case "text":case "textarea":c.value=b[a]||"";break;case "checkbox":c.selected=b[a]?!0:!1;break;case "radio":c.selected=(b[c.radio]||"")==c.value?!0:!1;break;case "select":c.selected=b[a]||""}})};e.contextMenu.getInputValues=
function(a,b){b===l&&(b={});e.each(a.inputs,function(a,c){switch(c.type){case "text":case "textarea":case "select":b[a]=c.$input.val();break;case "checkbox":b[a]=c.$input.prop("checked");break;case "radio":if(c.$input.prop("checked"))b[c.radio]=c.value}});return b};e.contextMenu.fromMenu=function(a){var a=e(a),b={};y(b,a.children());return b};e.contextMenu.defaults=v;e.contextMenu.types=u})(jQuery);
